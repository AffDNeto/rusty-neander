; Testes JSR/RTS
; inicia a pilha
MOV #SP_START R6
MOV #1 R0
JMP TST_START

SUB_SIMPLES:
INC R0
RTS R7
JMP ERR

TST_START:
; FLAGS DESLIGADAS
CCC NZCV
JSR R7,SUB_SIMPLES

; FLAGS LIGADAS
SCC NZCV
JSR R7,SUB_SIMPLES

; VERIFICA PILHA
JMP NX1
R6_CHECK:
INC R0
CMP R6 R6_TMP
BEQ B_ERR
RTS R7
JMP ERR

NX1:
MOV R6 R6_TMP
JSR R7,R6_CHECK
CMP R6 R6_TMP
BNE B_ERR

; VERIFICA ENDEREÃ‡O EM REGISTRADORES
JMP NX2
REG_CHECK:
INC R0
CMP R1 #RET
BNE B_ERR
CMP R1 (R6)
BNE B_ERR
RTS R1

NX2:
JSR R1,REG_CHECK
RET:
CMP R1 #RET
BNE B_ERR

JMP TEST_ADDRESS
B_ERR:
JMP ERR
; TESTES DE ENDERECAMENTOS
TEST_ADDRESS:
; IMEDIATO
MOV R0 R1
MOV #SUB_SIMPLES R2
JSR R7,R2   ;ENDERECAMENTO IMEDIATO DEVE SER IGNORADO
CMP R0 R1
BNE B_ERR

; POS INCREMENTADO
MOV R0 R1
MOV #SUB_SIMPLES R2
JSR R7,(R2)+
CMP R0 R1
BLE ERR ; SE R0<=R1

; PRE DEC
MOV R0 R1
MOV #SUB_SIMPLES R2
ADD #2 R2    ; ajuste para o pre decremento
JSR R7,-(R2)
CMP R0 R1
BLE ERR ; SE R0<=R1

; INDEXADO
MOV R0 R1
MOV #SUB_SIMPLES R2
INC R2      ; ajuste para o pre decremento
JSR R7,-1(R2)
CMP R0 R1
BLE ERR ; SE R0<=R1

; INDIRETO
MOV R0 R1
MOV #SUB_SIMPLES R2
JSR R7,(R2)
CMP R0 R1
BLE ERR ; SE R0<=R1

; POS INC INDIRETO
MOV R0 R1
MOV #TMP_INDEX R2
MOV #SUB_SIMPLES TMP_INDEX
JSR R7,((R2)+)
CMP R0 R1
BLE ERR ; SE R0<=R1

; PRE DEC INDIRETO
MOV R0 R1
MOV #SUB_SIMPLES R2
ADD #2 R2    ; ajuste para o pre decremento
MOV R2 TMP_INDEX
MOV #TMP_INDEX R2
JSR R7,(-(R2))
CMP R0 R1
BLE ERR ; SE R0<=R1

; INDEXADO INDIRETO
MOV R0 R1
MOV #SUB_SIMPLES R2
INC R2    ; ajuste para o pre decremento
MOV R2 TMP_INDEX
MOV #TMP_INDEX R2
JSR R7,(-1(R2))
CMP R0 R1
BLE ERR ; SE R0<=R1

END:
MOV R0 T0
MOV #0 E
ERR:
HLT

ORG 1024
SP_START: 0
E: 1
T0: 0
TMP_INDEX: 0
R6_TMP: 0